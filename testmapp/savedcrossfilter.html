<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Testing crossfilter</title>
  </head>
  <body>
    <div "id = diven"></div>
  </body>

  <script src="//d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
  <script>
  var data = [
  {date: "2011-11-14T16:17:54Z", quantity: 2, total: 190, tip: 100, type: "tab"},
  {date: "2011-11-14T16:20:19Z", quantity: 2, total: 190, tip: 100, type: "tab"},
  {date: "2011-11-14T16:28:54Z", quantity: 1, total: 300, tip: 200, type: "visa"},
  {date: "2011-11-14T16:30:43Z", quantity: 2, total: 90, tip: 0, type: "tab"},
  {date: "2011-11-14T16:48:46Z", quantity: 2, total: 90, tip: 0, type: "tab"},
  {date: "2011-11-14T16:53:41Z", quantity: 2, total: 90, tip: 0, type: "tab"},
  {date: "2011-11-14T16:54:06Z", quantity: 1, total: 100, tip: 0, type: "cash"},
  {date: "2011-11-14T16:58:03Z", quantity: 2, total: 90, tip: 0, type: "tab"},
  {date: "2011-11-14T17:07:21Z", quantity: 2, total: 90, tip: 0, type: "tab"},
  {date: "2011-11-14T17:22:59Z", quantity: 2, total: 90, tip: 0, type: "tab"},
  {date: "2011-11-14T17:25:45Z", quantity: 2, total: 200, tip: 0, type: "cash"},
  {date: "2011-11-14T17:29:52Z", quantity: 1, total: 200, tip: 100, type: "visa"}
];

  //Understanding crossfilter:

  var cross = crossfilter(data);
  d3.select("div").append("p").text("Cross.size() = data.length: " + cross.size());
  var datatotal = cross.dimension(function(d){return d.total;});
  // console.log(cross.top(100)); Detta fungerar ej,
  // console.log(datatotal.top(100)); Detta fungerar dock, och ger en array med alla object (date: quant.: etc)
  //Arrayen är också sorterad på den dimension som valts; så sorterad på total eller quantity eller liknande. En dimension måste gå att sortera, och alltså
  //vara en primitv typ eller så får man overrida valueOf. ????!!!! Möjligtvis är den inte initialt sorterad, men när man kallar på top() för att få ut en Array
  //så blir den sorterad
  var datatype = cross.dimension(function(d){return d.type;});
  // var datatypearray = datatype.top(cross.size()); //get all data as an array, sorted by the dimension
  // for(i = 0; i < datatypearray.length; i++){
  //   d3.select("div").append("p").text("Objects, sorted by datatype: " + datatypearray[i].date + " " + datatypearray[i].total + " " + datatypearray[i].type);
  // }
  // datatotal.filter(90);
  // var datatotalarray = datatotal.filter(90).top(cross.size());

  // //it seems that the filter is persistent, even if saved to another variable, like var x = datatotal.filter(90) datatotal is now filtered

  // var datatotalarray = datatotal.filter().top(cross.size());

  //however, you can "refilter" it by using another filter (or like here, no filter at all which brings everything back)

  //filter and filterExact seems to work the same for ints, maybe different for strings?
  //filterRange takes a range and returns >[0] and <[1], THIS IS THE ONE WE WILL USE
  // var datatotalarray = datatotal.filterRange([0,120]).top(cross.size());

  //you can also filter on a function:
  // var datatotalarray = datatotal.filterFunction(function(d){return d > 90}).top(Infinity); //can top(Infinity) instead of any one size, will return all objects that are filtered
  var datatotalarray = datatotal.filterAll().bottom(Infinity); //removes all filters, returns all the original data //bottom will sort in ascending order, top in descending

  for(i = 0; i < datatotalarray.length; i++){
    d3.select("div").append("p").text("Objects, sorted by total: " + datatotalarray[i].date + " " + datatotalarray[i].total + " " + datatotalarray[i].type);
  }










  // var colours = ["#ff9999", "#66ff66", "#6600ff", "#000099"];  We can have as many colours as we want, 20 for example
  // d3.select("div").append("svg").attr("width",100).attr("height",100).append("circle").attr("r",30).style("fill",function(d){return colour(0)});
  // //colour function the same d.person will always return the same colour.
  // function colour(i){
  //   console.log(i);
  //   i = i%4;
  //   console.log(i);
  //   return colours[i];
  // }

  </script>
</html>
